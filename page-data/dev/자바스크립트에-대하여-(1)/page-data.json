{"componentChunkName":"component---src-templates-blog-post-js","path":"/dev/자바스크립트에-대하여-(1)/","result":{"data":{"site":{"siteMetadata":{"title":"Memory !== Record","author":"Ayaan","siteUrl":"https://alpaca92.github.io","comment":{"disqusShortName":"","utterances":"Alpaca92/alpaca92.github.io"},"sponsor":{"buyMeACoffeeId":"ayaan92"}}},"markdownRemark":{"id":"996929f3-41b6-5fe5-9433-7e252dca36f5","excerpt":"자바스크립트를 메인 언어로 사용하기로 마음먹은지 1년 6개월 정도가 지났다 하지만 아직도 자바스크립트에 대해 깊게 공부해본 경험이 없다 올해 하반기에는 자바스크립트에 대해 보다 깊고 명확하게 이해해 보려고 한다 이 포스팅은 Modern Javascript Deep Dive, The Modern Javascript Tutorial…","html":"<p>자바스크립트를 메인 언어로 사용하기로 마음먹은지 1년 6개월 정도가 지났다</p>\n<p>하지만 아직도 자바스크립트에 대해 깊게 공부해본 경험이 없다</p>\n<p>올해 하반기에는 자바스크립트에 대해 보다 깊고 명확하게 이해해 보려고 한다</p>\n<p>이 포스팅은 <a href=\"http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&#x26;barcode=9791158392239\">Modern Javascript Deep Dive</a>, <a href=\"https://javascript.info/\">The Modern Javascript Tutorial</a>을 기반으로 작성하려고 한다</p>\n<p>오늘은 동기, 비동기에 대해 정리해보고자 한다</p>\n<h1 id=\"동기-처리와-비동기\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EA%B8%B0-%EC%B2%98%EB%A6%AC%EC%99%80-%EB%B9%84%EB%8F%99%EA%B8%B0\" aria-label=\"동기 처리와 비동기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동기 처리와 비동기</h1>\n<p>함수를 호출하면 함수 코드가 평가되어 함수 <code class=\"language-text\">실행 컨텍스트</code>가 생성된다</p>\n<p>이때 생성된 함수 실행 컨텍스트는 실행 컨텍스트 스택(콜 스택)에 푸시되고 함수코드가 실행된다</p>\n<p>함수 코드의 실행이 종료되면 함수 실행 컨텍스트는 실행 컨텍스트 스택에서 팝되어 제거된다</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* call stack */</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'global execution context'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo is executing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo has finished executing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar is executing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar has finished executing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'baz is executing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'baz has finished executing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'program successfully executed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// global execution context</span>\n<span class=\"token comment\">// baz is executing</span>\n<span class=\"token comment\">// bar is executing</span>\n<span class=\"token comment\">// foo is executing</span>\n<span class=\"token comment\">// foo has finished executing</span>\n<span class=\"token comment\">// bar has finished executing</span>\n<span class=\"token comment\">// baz has finished executing</span>\n<span class=\"token comment\">// program successfully executed</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAd5UBX//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAACAwEBAAAAAAAAAAAAAAAAARExUSGB/9oACAEBAAE/IZs9FXXJCwhYVR//2gAMAwEAAgADAAAAEIgP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAAAH/2gAIAQIBAT8QR//EABsQAQADAQEBAQAAAAAAAAAAAAEAESExUUFh/9oACAEBAAE/EH5IV6TVM1XKhSlj2dsb3OzYaZhkAFAD8n//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"콜 스택\"\n        title=\"콜 스택\"\n        src=\"/static/2371d302639ea239a52842bf3a1800e8/e5166/sync_and_async_01.jpg\"\n        srcset=\"/static/2371d302639ea239a52842bf3a1800e8/f93b5/sync_and_async_01.jpg 300w,\n/static/2371d302639ea239a52842bf3a1800e8/b4294/sync_and_async_01.jpg 600w,\n/static/2371d302639ea239a52842bf3a1800e8/e5166/sync_and_async_01.jpg 1200w,\n/static/2371d302639ea239a52842bf3a1800e8/f46db/sync_and_async_01.jpg 1357w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>여기서 중요한 사실은 <strong><code class=\"language-text\">자바스크립트 엔진은 단 하나의 콜 스택</code></strong>을 갖는다는 것이다</p>\n<p>이는 함수를 실행할 수 있는 창구가 단 하나이며, 2개 이상의 함수를 동시에 실행할 수 없다는 것을 의미한다</p>\n<p>콜스택의 최상위 요소인 ‘실행 중인 실행 컨텍스트’를 제외한 모든 실행 컨텍스트는 모두 태스크(task)들이다</p>\n<p>태스크들은 현재 실행중인 실행 컨텍스트가 pop되어 콜스택에서 제거되면 비로소 실행되기 시작한다</p>\n<p>이처럼 자바스크립트 엔진은 한 번에 하나의 태스크만 실행할 수 있는 <code class=\"language-text\">single thread</code>방식으로 동작한다</p>\n<p>싱글 스레드 방식은 한 번에 하나의 태스크만 실행할 수 있기 때문에 처리 시간이 걸리는 태스크를 실행하는 경우 <strong>블로킹(blocking, 작업 중단)</strong>이 발생한다</p>\n<p>예를 들어 <code class=\"language-text\">setTimeout</code>함수와 유사하게 일정 시간이 경과한 이후 콜백 함수를 호출하는 함수를 구현해 보도록 하자</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback<span class=\"token punctuation\">,</span> delay</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> delayUntil <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> delay<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> delayUntil<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// foo * many times</span>\n\n<span class=\"token comment\">// after 3sec or more</span>\n<span class=\"token comment\">// bar</span></code></pre></div>\n<p>위와 같이 <code class=\"language-text\">bar</code>는 <code class=\"language-text\">sleep</code>에 의해 3초 이상(3초 + foo함수의 실행시간) 호출되지 못하는 블로킹(작업 중단) 상태가 된다</p>\n<p>이처럼 현재 실행 중인 태스크가 종료할 때까지 다음에 실행될 태스크가 대기하는 방식을 <strong><code class=\"language-text\">동기(synchronous) 처리</code></strong>라고 한다</p>\n<p>동기 처리를 하게되면 실행 순서가 보장되지만 앞선 태스크가 종료할 때까지 이후 태스크들이 블로킹된다는 단점도 분명하다</p>\n<p>이번엔 <code class=\"language-text\">setTimeout</code>을 사용해 보도록 하자</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// bar</span>\n<span class=\"token comment\">// after 3 sec</span>\n<span class=\"token comment\">// foo</span></code></pre></div>\n<p><code class=\"language-text\">setTimeout</code>함수는 앞서 살펴본 sleep함수와 유사하게 일정 시간이 경과한 후 콜백 함수를 호출하지만 <code class=\"language-text\">setTimeout</code>은 이후의 태스크를 블로킹하지 않고 곧바로 실행한다</p>\n<p>이처럼 현재 실행 중인 태스크가 종료되지 않은 상태라해도 다음 태스크를 곧바로 실행하는 방식을 <strong><code class=\"language-text\">비동기(asynchronous) 처리</code></strong>라고 한다</p>\n<p>비동기 처리 방식은 현재 실행 중인 태스크가 종료되지 않은 상태라 해도 다음 태스크를 곧바로 실행하므로 블로킹이 발생하지 않지만 태스크들의 실행 순서를 보장하지 않는 단점이 있다</p>\n<p>위 예시에서 봤듯이 비동기 처리를 수행하는 비동기 함수는 전통적으로 콜백 패턴을 사용한다</p>\n<p>하지만 비동기 처리를 위한 콜백 패턴은 콜백 지옥(callback hell)을 발생시켜 가독성을 나쁘게 하고, 비동기 처리 중 발생한 에러의 예외 처리가 곤란하며, 여러개의 비동기 처리를 한번에 처리하는 데도 한계가 있다</p>\n<p>이를 계선한 것이 바로 <code class=\"language-text\">프로미스(Promise)</code>이다</p>\n<blockquote>\n<p>타이머 함수인 <code class=\"language-text\">setTimeout</code>과 <code class=\"language-text\">setInterval</code>, <code class=\"language-text\">HTTP Request</code>, <code class=\"language-text\">Event handler</code>는 비동기 처리 방식으로 동작한다</p>\n</blockquote>\n<p>이제 비동기 처리에 깊은 관계가 있는 이벤트 루프(event loop), 태스크 큐(task queue)에 대해 알아보자</p>\n<h1 id=\"이벤트-루프와-태스크-큐\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84%EC%99%80-%ED%83%9C%EC%8A%A4%ED%81%AC-%ED%81%90\" aria-label=\"이벤트 루프와 태스크 큐 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이벤트 루프와 태스크 큐</h1>\n<p>자바스크립트의 특증 중 하나는 위에서도 언급했듯이 싱글 스레드로 동작한다는 것이다</p>\n<p>하지만 브라우저가 동작하는 것을 보면 많은 태스크들이 동시에 처리되는 것 처럼 보여 우리를 혼동시킨다</p>\n<p>예를 들어, HTML 요소가 애니메이션 효과를 통해 움직이면서 이벤트를 처리하기도 하고, HTTP 요청을 통해 서버로부터 데이터를 가지고 오면서 렌더링하기도 한다</p>\n<p>이처럼 자바스크립트의 동시성(concurrency)을 지원하는 것이 바로 <code class=\"language-text\">이벤트 루프(event loop)</code>다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHszRgo0Gp//8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERAgMSIf/aAAgBAQABBQKjb651ySMzT0//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFX/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAEQIRIxcf/aAAgBAQAGPwJX0eNlo1P/xAAcEAACAgIDAAAAAAAAAAAAAAAAARExIVFhcdH/2gAIAQEAAT8hlTyJfkVDFN9CQuBAni3Itkf/2gAMAwEAAgADAAAAEKMf/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8QR//EABgRAQEAAwAAAAAAAAAAAAAAAAEAESFB/9oACAECAQE/EDTmS8v/xAAdEAEAAwACAwEAAAAAAAAAAAABABEhMZFBUWFx/9oACAEBAAE/ELxWebIU6gPobt8eo6RBo2Z3Ape+DZu3C2nTTFTG/wBn/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"자바스크립트 동작 모식도\"\n        title=\"자바스크립트 동작 모식도\"\n        src=\"/static/dacfa859b07f4f3337edcc719af1c211/e5166/sync_and_async_02.jpg\"\n        srcset=\"/static/dacfa859b07f4f3337edcc719af1c211/f93b5/sync_and_async_02.jpg 300w,\n/static/dacfa859b07f4f3337edcc719af1c211/b4294/sync_and_async_02.jpg 600w,\n/static/dacfa859b07f4f3337edcc719af1c211/e5166/sync_and_async_02.jpg 1200w,\n/static/dacfa859b07f4f3337edcc719af1c211/ac99c/sync_and_async_02.jpg 1536w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>이벤트 루프는 브라우저에 내장되어 있는 기능 중 하나인데 보통 위와 같이 표현된다</p>\n<ol>\n<li><strong>call stack / function execution stack</strong></li>\n</ol>\n<p>소스코드 평가 과정에서 생성된 실행 컨텍스트가 추가되고 제거되는 스택 자료구조</p>\n<p>함수를 호출하면 함수 실행 컨텍스트가 순차적으로 콜 스택에 push되어 순차적으로 실행된다<br />(즉, 선입후출(FILO, First in, Last out)의 구조를 가지고 있다)</p>\n<p>자바스크립트 엔진은 단 하나의 콜 스택을 사용하기 때문에(싱글 스레드) 최상위 실행 컨텍스트가 종료되어 콜 스택에서 제거(pop)되기 전까지는 다른 어떤 태스크도 실행되지 않는다</p>\n<ol start=\"2\">\n<li><strong>heap</strong></li>\n</ol>\n<p>힙은 객체가 저장되는 메모리 공간으로 <code class=\"language-text\">memory heap</code>이라고도 불린다</p>\n<p>콜 스택의 요소인 실행 컨텍스트는 힙에 저장된 객체를 참조한다</p>\n<p>메모리에 값을 저장하려면 먼저 값을 저장할 메모리 공간의 크기를 결정해야 하는데 객체는 원시 값과는 달리 크기가 정해져 있지 않으므로 할당해야 할 메모리 공간의 크기를 런타임에 결정(동적 할당)해야 한다</p>\n<p>따라서 객체가 저장되는 메모리 공간인 힙은 구조화되어 있지 않다는게 특징이다</p>\n<p>이처럼 <strong>콜 스택과 힙으로 구성되어 있는 자바스크립트 엔진</strong>은 단순히 태스크가 요청되면 콜 스택을 통해 요청된 작업을 순차적으로 실행할 뿐이다</p>\n<p><strong>비동기 처리에서 소스코드의 평가와 실행을 제외한 모든 처리는 자바스크립트 엔진을 구동하는 환경인 브라우저 또는 Node.js가 담당한다</strong></p>\n<p>예를 들어, 비동기 방식으로 동작하는 setTimeout의 콜백 함수의 평가와 실행은 자바스크립트 엔진이 담당하지만 호출 스케줄링을 위한 타이머 설정과 콜백 함수의 등록은 브라우저 또는 Node.js가 담당한다</p>\n<p>이를 위해 브라우저 환경은 태스크 큐(콜백 큐)와 이벤트 루프를 제공한다</p>\n<ol start=\"3\">\n<li><strong>task queue / event queue, callback queue</strong></li>\n</ol>\n<p>setTimeout이나 setInterval과 같은 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역이다</p>\n<p>콜백 큐와 별도로 프로미스의 후속 처리 메서드의 콜백 함수가 일시적으로 보관되는 마이크로태스크 큐도 존재한다</p>\n<p>이에 대해서는 나중에 좀 더 자세히 다뤄보도록 하자</p>\n<ol start=\"4\">\n<li><strong>event loop</strong></li>\n</ol>\n<p>이벤트 루프는 콜 스택에 현재 실행중인 실행 컨텍스트가 있는지 그리고 콜백 큐에 대기 중인 함수가 있는지 반복해서 확인한다</p>\n<p>만약 <strong>콜 스택이 비어있고 태스크 큐에 대기 중인 함수가 있다면 이벤트 루프는 순차적(선입 선출(FIFO, First in, First out))으로 콜백 큐에 대기 중인 함수를 콜 스택으로 이동시킨다</strong></p>\n<p>이때 콜 스택으로 이동한 함수는 실행되는데 이는 <strong>콜백 큐에 일시 보관된 함수들은 비동기 처리 방식으로 동작한다는 뜻이다</strong></p>\n<p>이제 브라우저 환경에서 다음 예제가 어떻게 동작할지 상상해보자</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">f1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'f1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">f2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'f2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>f1<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">f2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>0초 뒤에 <code class=\"language-text\">f1</code>이 실행된다면</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// main</span>\n<span class=\"token comment\">// f1</span>\n<span class=\"token comment\">// f2</span></code></pre></div>\n<p>‘위와 같이 출력되는 것이 아닐까?’ 싶지만 setTimeout의 지연시간이 4ms 이하인 경우 지연시간은 4ms로 지정된다 <a href=\"https://stackoverflow.com/questions/9647215/what-is-minimum-millisecond-value-of-settimeout\">ref</a></p>\n<p>따라서 출력은 아래와 같을 것이다</p>\n<p><img src=\"/c7a81b58f4c75c32a0b6503ffa5f8fd1/sync_and_async_03.gif\"></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// main</span>\n<span class=\"token comment\">// f2</span>\n<span class=\"token comment\">// f1</span></code></pre></div>\n<p>이를 좀 더 구체적으로 살펴본다면</p>\n<ol>\n<li>전역 코드가 평가되어 전역 실행 컨텍스트가 생성되고 콜 스택에 push된다</li>\n<li>전역 코드가 실행되기 시작하여 <code class=\"language-text\">main</code>함수의 실행 컨텍스트가 생성되고 실행된다</li>\n<li>콘솔에 <code class=\"language-text\">main</code>이 출력되고 <code class=\"language-text\">setTimeout</code>함수가 호출된다</li>\n<li><code class=\"language-text\">setTimeout</code>함수의 실행 컨텍스트가 생성되고 콜 스택에 push되어 현재 실행 중인 실행 컨텍스트가 된다<br />브라우저의 Web API(호스트 객체)인 타이머 함수도 함수이므로 실행 컨텍스트를 생성한다</li>\n<li><code class=\"language-text\">setTimeout</code>함수가 실행되면 콜백 함수를 호출 스케줄링하고 종료되어 콜 스택에서 pop된다<br />이때 호출 스케줄링, 즉 타이머 설정과 타이머가 만료되면 콜백 함수를 콜백 큐에 push하는 것은 브라우저의 역할이다</li>\n<li>브라우저가 수행하는 6-1, 자바스크립트 엔진이 수행하는 6-2는 병행 처리된다<br />\n<br />\n6-1. 브라우저는 타이머를 설정하고 타이머의 만료를 기다린다<br />\n4ms후 타이머가 만료되면 콜백 함수 <code class=\"language-text\">f1</code>가 콜백 큐에 push되어 대기상태가 된다<br />\n<br />\n6-2. <code class=\"language-text\">f2</code>함수가 호출되어 실행 컨텍스트가 생성되고 콜 스택에 push되어 현재 실행 중인 실행 컨텍스트가 된다<br />\n이후 콘솔에 <code class=\"language-text\">f2</code>이 출력되고, <code class=\"language-text\">f2</code>함수가 종료되어 콜 스택에서 pop된다<br />\n이때 브라우저가 타이머를 설정한 후 4ms가 경과했다면 <code class=\"language-text\">f1</code>함수는 아직 콜백 큐에서 대기 중이다</li>\n<li><code class=\"language-text\">main</code>함수의 실행 컨텍스트가 종료되고 콜 스택에서 팝된다<br />이로서 콜 스택에는 아무런 실행 컨텍스트가 존재하지 않게 된다</li>\n<li>이벤트 루프에 의해 콜 스택이 비어 있음이 감지되고 콜백 큐에서 대기 중인 콜백 함수 <code class=\"language-text\">f1</code>이 이벤트 루프에 의해 콜 스택에 push된다<br />다시 말해, 콜백 함수 <code class=\"language-text\">f1</code>의 실행 컨텍스트가 생성되고 콜 스택에 push되어 현재 실행중인 실행 컨텍스트가 되며, 이후 콘솔에 <code class=\"language-text\">f1</code>이 출력되고 <code class=\"language-text\">f1</code>함수가 종료되어 콜 스택에서 pop된다</li>\n</ol>\n<p>이처럼 <strong>비동기 함수인 <code class=\"language-text\">setTimeout</code>의 콜백 함수는 콜백 큐에 push되어 대기하다가 콜 스택이 비게되면 비로소 콜 스택에 push되어 실행된다</strong></p>\n<p><strong>다시 말하지만 자바스크립트는 싱글 스레드 방식으로 동작한다</strong></p>\n<p><strong>이때 싱글 스레드 방식으로 동작하는 것은 브라우저에 내장된 ‘자바스크립트 엔진’이지 브라우저 자체가 아님에 주의하자</strong></p>\n<p><strong>만약 자바스크립트가 모두 자바스크립트 엔진에 의해 싱글 스레드 방식으로 동작한다면 자바스크립트는 비동기로 동작할 수 없다</strong></p>\n<p><strong>즉, 브라우저는 멀티 스레드로 동작한다는 말이다</strong></p>\n<p>브라우저는 자바스크립트 엔진 외에도 렌더링 엔진과 Web API를 제공한다</p>\n<p>Web API는 ECMAScript 사양에 정의된 함수가 ㅇ나니라 브라우저에서 제공하는 API이며, DOM API와 타이머 함수, HTTP 요청(Ajax)와 같은 비동기 처리를 포함한다</p>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>*references</h2>\n<ol>\n<li><a href=\"https://dev.to/ahmedtahir/what-is-the-execution-context-execution-stack-scope-chain-in-js-26nc\">What is the Execution Context, Execution Stack &#x26; Scope Chain in JS</a></li>\n<li><a href=\"https://www.freecodecamp.org/news/synchronous-vs-asynchronous-in-javascript/\">Synchronous vs Asynchronous JavaScript – Call Stack, Promises, and More</a></li>\n</ol>","frontmatter":{"title":"자바스크립트에 대하여 (1) - 동기, 비동기처리","date":"August 31, 2022"}}},"pageContext":{"slug":"/dev/자바스크립트에-대하여-(1)/","previous":{"fields":{"slug":"/dev/what-is-pwa/"},"frontmatter":{"title":"PWA(Progressive Web App)이란?"}},"next":{"fields":{"slug":"/react/react-flux-pattern/"},"frontmatter":{"title":"React Flux pattern"}}}}}